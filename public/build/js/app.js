let $pasos=1;const $pasoInicial=1,$pasoFinal=3;let cita={id:"",nombre:"",fecha:"",hora:"",servicios:[]};function App(){MostrandoInformacion(),Paginador(),PaginadorSiguiente(),PaginadorAnterior(),__main__(),consultarAPI(),idCliente(),nombreCliente(),seleccionarFecha(),seleccionarHora(),MostrarResumen()}function MostrandoInformacion(){const e=document.querySelector(".mostrar");e&&e.classList.remove("mostrar"),$vAnterior=document.querySelector(".activo"),$vAnterior&&$vAnterior.classList.remove("activo");const t="#paso-"+$pasos;document.querySelector(t).classList.add("mostrar");document.querySelector(`[data-paso="${$pasos}"]`).classList.add("activo")}function __main__(){document.querySelectorAll('.navegacion [type="button"]').forEach(e=>{e.addEventListener("click",(function(e){$pasos=parseInt(e.target.dataset.paso),Paginador(),MostrandoInformacion()}))})}function Paginador(){let e=document.querySelector("#anterior"),t=document.querySelector("#siguiente");1===$pasos?(e.classList.add("ocultado"),t.classList.remove("ocultado")):3===$pasos?(t.classList.add("ocultado"),e.classList.remove("ocultado"),MostrarResumen()):(t.classList.remove("ocultado"),e.classList.remove("ocultado")),MostrandoInformacion()}function PaginadorAnterior(){document.querySelector("#anterior").addEventListener("click",(function(){$pasos<=1||($pasos--,Paginador())}))}function PaginadorSiguiente(){document.querySelector("#siguiente").addEventListener("click",(function(){$pasos>=3||($pasos++,Paginador())}))}async function consultarAPI(){try{const e="http://localhost:3000/api/servicios",t=await fetch(e,{method:"GET"});if(t.ok){MostrarServicios(await t.json())}else console.log("Generado-Error : "+t.status)}catch(e){console.log(e)}}function MostrarServicios(e){e.forEach(e=>{const{id:t,Nombre:o,Precio:a}=e,n=document.createElement("P");n.classList.add("estilo-producto"),n.innerHTML=""+o;const r=document.createElement("P");r.classList.add("estilo-precio"),r.innerHTML="$"+a;const c=document.createElement("DIV");c.classList.add("estilos-servicios"),c.dataset.id=t,c.onclick=function(){MostrarSeccionProducto(e)},c.appendChild(n),c.appendChild(r),document.querySelector("#servicios").appendChild(c)})}function MostrarSeccionProducto(e){const{id:t}=e,{servicios:o}=cita;let a=document.querySelector(`[data-id="${t}"]`);if(o.some(e=>e.id===t)){let e=e=>e.id!==t;cita.servicios=o.filter(e),a.classList.remove("seleccionado")}else cita.servicios=[...o,e],a.classList.add("seleccionado")}function nombreCliente(){cita.nombre=document.querySelector("#Nombre").value}function idCliente(){cita.id=document.querySelector("#id").value}function seleccionarFecha(){document.querySelector("#fecha").addEventListener("input",(function(e){const t=new Date(e.target.value).getUTCDay();[0,6].includes(t)?(e.target.value=" ",mostrarAlerta("Fines de semana no permitidos","error",".formulario")):cita.fecha=e.target.value}))}function seleccionarHora(){document.querySelector("#hora").addEventListener("input",(function(e){const t=e.target.value.split(":")[0];t<10||t>18?(e.target.value="",mostrarAlerta("El horario de citas son de las 10:00 AM hasta las 18:00 PM","error",".formulario")):cita.hora=e.target.value}))}function mostrarAlerta(e,t,o,a=!0){let n=document.querySelector(".alerta");n&&n.remove();let r=document.createElement("DIV");r.textContent=e,r.classList.add("alerta"),r.classList.add(t),document.querySelector(o).appendChild(r),a&&setTimeout(()=>{r.remove()},5e3)}function MostrarResumen(){const e=document.querySelector(".contenido-resumen");for(;e.firstChild;)e.removeChild(e.firstChild);if(Object.values(cita).includes("")||0===cita.servicios.length)return void mostrarAlerta("Revisa que tus datos de la cita y servicios esten completos","error",".contenido-resumen",!1);const{nombre:t,fecha:o,hora:a,servicios:n}=cita,r=document.createElement("H3");r.textContent="Resumen de tus servicios",e.appendChild(r),n.forEach(t=>{const{id:o,Nombre:a,Precio:n}=t,r=document.createElement("DIV");r.classList.add("contenedor-servicio");const c=document.createElement("P");c.classList.add("nombre_servicio-parrafo"),c.textContent=a;const i=document.createElement("P");i.classList.add("precio_servicio-parrafo"),i.innerHTML=`<span>Precio: </span> $${n} `,r.appendChild(c),r.appendChild(i),e.appendChild(r)});const c=document.createElement("H3");c.textContent="Resumen de tu cita",e.appendChild(c);const i=document.createElement("P");i.innerHTML="<span>Cliente: </span> "+t;const s=new Date(o),d=s.getMonth(),l=s.getDate()+2,u=s.getFullYear();const m=new Date(Date.UTC(u,d,l)).toLocaleDateString("es-ES",{weeday:"long",year:"numeric",month:"long",day:"numeric"}),p=document.createElement("P");p.innerHTML="<span>Fecha de cita: </span> "+m;const v=document.createElement("P");v.innerHTML="<span>Hora de cita: </span> "+a;const f=document.createElement("BUTTON");f.classList.add("boton"),f.textContent="Reservar Cita",f.onclick=ReservarCita,e.appendChild(i),e.appendChild(p),e.appendChild(v),e.appendChild(f)}async function ReservarCita(){const{nombre:e,fecha:t,hora:o,servicios:a,id:n}=cita,r=new FormData;r.append("Fecha",t),r.append("Hora",o),r.append("usuarioId",n),r.append("servicios",a.map(e=>e.id));try{const e="http://localhost:3000/api/citas",t=await fetch(e,{method:"POST",body:r});(await t.json()).resultado&&Swal.fire({icon:"success",title:"Cita Creada",text:"Ha sido registrado correctamente tu cita",button:"Ok"}).then(()=>{setTimeout(()=>{window.location.reload()},2e3)})}catch(e){Swal.fire({icon:"error",title:"Oops...",text:"Ha ocurrido un error!",button:"continuar"}).then(()=>{window.location.reload()})}}document.addEventListener("DOMContentLoaded",(function(){App()}));